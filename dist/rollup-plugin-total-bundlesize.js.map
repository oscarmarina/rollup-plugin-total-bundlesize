{"version":3,"file":"rollup-plugin-total-bundlesize.js","sources":["../src/calculateBundleSizes.js","../src/rollupPluginTotalBundlesize.js"],"sourcesContent":["import { gzipSync, brotliCompressSync } from \"node:zlib\";\nimport { minify } from \"terser\";\n\n/**\n * @param {number} num\n * @returns {string}\n */\nconst toReadableNumber = (num) => {\n  return num.toLocaleString('en', {maximumFractionDigits: 2});\n};\n\n/**\n * Formats a byte value into a human-readable string (e.g. \"1.5 KB\").\n * Uses JEDEC standard units (KB, MB, GB, TB).\n * @param {number} value - Size in bytes\n * @returns {string}\n */\nexport const formatSize = (value) => {\n  switch (true) {\n    case value < 1e3:\n      return toReadableNumber(value) + ' B';\n    case value >= 1e3 && value < 1e6:\n      return toReadableNumber(value / 1e3) + ' KB';\n    case value >= 1e6 && value < 1e9:\n      return toReadableNumber(value / 1e6) + ' MB';\n    case value >= 1e9 && value < 1e12:\n      return toReadableNumber(value / 1e9) + ' GB';\n    case value >= 1e12:\n      return toReadableNumber(value / 1e12) + ' TB';\n    default:\n      return toReadableNumber(value) + ' B';\n  }\n};\n\nexport default function calculateBundleSizes(options = {}) {\n  const {\n    showGzippedSize = true,\n    showBrotliSize = false,\n    showMinifiedSize = true,\n    reporter,\n  } = options;\n\n  const getLoggingData = async function (outputOptions, bundle) {\n    const { code, fileName } = bundle;\n    const info = { fileName };\n\n    info.bundleSize = formatSize(Buffer.byteLength(code));\n\n    info.brotliSize = showBrotliSize\n      ? formatSize(brotliCompressSync(code).length)\n      : \"\";\n\n    if (showMinifiedSize || showGzippedSize) {\n      const minifiedCode = (await minify(code)).code ?? code;\n      info.minSize = showMinifiedSize\n        ? formatSize(minifiedCode.length)\n        : \"\";\n      info.gzipSize = showGzippedSize\n        ? formatSize(gzipSync(minifiedCode).length)\n        : \"\";\n    }\n    if (reporter) {\n      reporter(\n        { showGzippedSize, showBrotliSize, showMinifiedSize },\n        outputOptions,\n        info\n      );\n    }\n  };\n\n  return {\n    name: \"calculateBundleSizes\",\n    async generateBundle(outputOptions, bundle) {\n      await Promise.all(\n        Object.values(bundle)\n          .filter((currentBundle) =>\n            currentBundle.type ? currentBundle.type !== \"asset\" : !currentBundle.isAsset\n          )\n          .map((currentBundle) => getLoggingData(outputOptions, currentBundle))\n      );\n    },\n  };\n}\n","// @ts-nocheck\nimport boxen from 'boxen';\nimport calculateBundleSizes, { formatSize } from './calculateBundleSizes.js';\n\nconst colors = {\n  reset: '\\x1b[0m',\n  yellowBright: '\\x1b[93m',\n  cyan: '\\x1b[36m',\n  blackBright: '\\x1b[90m',\n  green: '\\x1b[32m',\n};\nexport default ({showFileDetail = false, ...boxenOptions} = {}) => {\n  const boxenOptionsDefault = {\n    padding: {\n      top: 0,\n      right: 1,\n      bottom: 0,\n      left: 1,\n    },\n    title: 'Total size',\n    borderStyle: 'single',\n    ...boxenOptions,\n  };\n\n  /**\n   * @param {string} value\n   * @returns {number}\n   */\n  const calculateByteSize = (value) => {\n    let [num, unit] = value.split(' ');\n    num = parseFloat(num);\n    switch (unit) {\n      case 'B':\n        return num;\n      case 'KB':\n        return num * 1e3;\n      case 'MB':\n        return num * 1e6;\n      case 'GB':\n        return num * 1e9;\n      default:\n        return num;\n    }\n  };\n\n  let totalBundleSize = 0;\n  let totalMinSize = 0;\n  let totalGzipSize = 0;\n  let totalBrotliSize = 0;\n\n  /** @type {Array<{fileName: string, bundleSize: string, minSize: string, gzipSize: string, brotliSize: string}>} */\n  const fileDetails = [];\n\n  return {\n    name: 'rollup-plugin-total-bundlesize',\n    generateBundle: async (...args) => {\n      await calculateBundleSizes({\n        showBrotliSize: true,\n        reporter: (options, bundle, {fileName, bundleSize, minSize, gzipSize, brotliSize}) => {\n          totalBundleSize += calculateByteSize(bundleSize);\n          totalMinSize += calculateByteSize(minSize);\n          totalGzipSize += calculateByteSize(gzipSize);\n          totalBrotliSize += calculateByteSize(brotliSize);\n          if (showFileDetail) {\n            fileDetails.push({fileName, bundleSize, minSize, gzipSize, brotliSize});\n          }\n        },\n      }).generateBundle(...args);\n    },\n    closeBundle() {\n      if (showFileDetail) {\n        console.log('');\n        for (const f of fileDetails) {\n          console.log(\n            `  ${colors.green}${f.fileName}${colors.reset} â†’ ${f.bundleSize} (min: ${f.minSize}, gz: ${f.gzipSize}, br: ${f.brotliSize})`\n          );\n        }\n      }\n\n      const output = `${colors.cyan}Bundle:${colors.reset}${colors.blackBright}${formatSize(\n        totalBundleSize\n      )}${colors.reset} | ${colors.cyan}Minified:${colors.reset}${\n        colors.blackBright\n      }${formatSize(totalMinSize)}${colors.reset} | ${colors.cyan}Gzipped:${\n        colors.blackBright\n      }${formatSize(totalGzipSize)}${colors.reset} | ${colors.cyan}Brotli:${colors.reset}${\n        colors.blackBright\n      }${formatSize(totalBrotliSize)}`;\n\n      console.log(colors.reset);\n      console.log(boxen(`${colors.yellowBright}${output}${colors.reset}`, boxenOptionsDefault));\n    },\n  };\n};\n"],"names":["toReadableNumber","num","toLocaleString","maximumFractionDigits","formatSize","value","calculateBundleSizes","options","showGzippedSize","showBrotliSize","showMinifiedSize","reporter","name","generateBundle","outputOptions","bundle","Promise","all","Object","values","filter","currentBundle","type","isAsset","map","async","code","fileName","info","bundleSize","Buffer","byteLength","brotliSize","brotliCompressSync","length","minifiedCode","minify","minSize","gzipSize","gzipSync","getLoggingData","colors","rollupPluginTotalBundlesize","showFileDetail","boxenOptions","boxenOptionsDefault","padding","top","right","bottom","left","title","borderStyle","calculateByteSize","unit","split","parseFloat","totalBundleSize","totalMinSize","totalGzipSize","totalBrotliSize","fileDetails","args","push","closeBundle","console","log","f","output","boxen"],"mappings":"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"}