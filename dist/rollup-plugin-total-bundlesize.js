import e from"boxen";import{brotliCompressSync as i,gzipSync as t}from"node:zlib";import{minify as n}from"terser";const o=e=>e.toLocaleString("en",{maximumFractionDigits:2}),r=e=>{switch(!0){case e<1e3:return o(e)+" B";case e>=1e3&&e<1e6:return o(e/1e3)+" KB";case e>=1e6&&e<1e9:return o(e/1e6)+" MB";case e>=1e9&&e<1e12:return o(e/1e9)+" GB";case e>=1e12:return o(e/1e12)+" TB";default:return o(e)+" B"}};function l(e={}){const{showGzippedSize:o=!0,showBrotliSize:l=!1,showMinifiedSize:s=!0,reporter:a}=e;return{name:"calculateBundleSizes",async generateBundle(e,c){await Promise.all(Object.values(c).filter(e=>e.type?"asset"!==e.type:!e.isAsset).map(c=>async function(e,c){const{code:u,fileName:z}=c,m={fileName:z};if(m.bundleSize=r(Buffer.byteLength(u)),m.brotliSize=l?r(i(u).length):"",s||o){const e=(await n(u)).code??u;m.minSize=s?r(e.length):"",m.gzipSize=o?r(t(e).length):""}a&&a({showGzippedSize:o,showBrotliSize:l,showMinifiedSize:s},e,m)}(e,c)))}}}const s="[0m",a="[93m",c="[36m",u="[90m",z="[32m";var m=({showFileDetail:i=!1,...t}={})=>{const n={padding:{top:0,right:1,bottom:0,left:1},title:"Total size",borderStyle:"single",...t},o=e=>{let[i,t]=e.split(" ");switch(i=parseFloat(i),t){case"B":default:return i;case"KB":return 1e3*i;case"MB":return 1e6*i;case"GB":return 1e9*i}};let m=0,$=0,d=0,p=0;const S=[];return{name:"rollup-plugin-total-bundlesize",generateBundle:async(...e)=>{await l({showBrotliSize:!0,reporter:(e,t,{fileName:n,bundleSize:r,minSize:l,gzipSize:s,brotliSize:a})=>{m+=o(r),$+=o(l),d+=o(s),p+=o(a),i&&S.push({fileName:n,bundleSize:r,minSize:l,gzipSize:s,brotliSize:a})}}).generateBundle(...e)},closeBundle(){if(i){console.log("");for(const e of S)console.log(`  ${z}${e.fileName}${s} â†’ ${e.bundleSize} (min: ${e.minSize}, gz: ${e.gzipSize}, br: ${e.brotliSize})`)}const t=`${c}Bundle:${s}${u}${r(m)}${s} | ${c}Minified:${s}${u}${r($)}${s} | ${c}Gzipped:${u}${r(d)}${s} | ${c}Brotli:${s}${u}${r(p)}`;console.log(s),console.log(e(`${a}${t}${s}`,n))}}};export{m as default};
//# sourceMappingURL=rollup-plugin-total-bundlesize.js.map
