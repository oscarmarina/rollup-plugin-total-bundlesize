"use strict";var e=require("boxen"),i=require("node:zlib"),t=require("terser");const n=e=>e.toLocaleString("en",{maximumFractionDigits:2}),r=e=>{switch(!0){case e<1e3:return n(e)+" B";case e>=1e3&&e<1e6:return n(e/1e3)+" KB";case e>=1e6&&e<1e9:return n(e/1e6)+" MB";case e>=1e9&&e<1e12:return n(e/1e9)+" GB";case e>=1e12:return n(e/1e12)+" TB";default:return n(e)+" B"}};function l(e={}){const{showGzippedSize:n=!0,showBrotliSize:l=!1,showMinifiedSize:o=!0,reporter:s}=e;return{name:"calculateBundleSizes",async generateBundle(e,a){await Promise.all(Object.values(a).filter(e=>e.type?"asset"!==e.type:!e.isAsset).map(a=>async function(e,a){const{code:c,fileName:u}=a,z={fileName:u};if(z.bundleSize=r(Buffer.byteLength(c)),z.brotliSize=l?r(i.brotliCompressSync(c).length):"",o||n){const e=(await t.minify(c)).code??c;z.minSize=o?r(e.length):"",z.gzipSize=n?r(i.gzipSync(e).length):""}s&&s({showGzippedSize:n,showBrotliSize:l,showMinifiedSize:o},e,z)}(e,a)))}}}const o="[0m",s="[93m",a="[36m",c="[90m",u="[32m";module.exports=({showFileDetail:i=!1,...t}={})=>{const n={padding:{top:0,right:1,bottom:0,left:1},title:"Total size",borderStyle:"single",...t},z=e=>{let[i,t]=e.split(" ");const n=parseFloat(i);switch(t){case"B":default:return n;case"KB":return 1e3*n;case"MB":return 1e6*n;case"GB":return 1e9*n}};let S=0,$=0,d=0,p=0;const m=[];return{name:"rollup-plugin-total-bundlesize",apply:"build",generateBundle:async(...e)=>{await l({showBrotliSize:!0,reporter:(e,t,{fileName:n,bundleSize:r,minSize:l,gzipSize:o,brotliSize:s})=>{S+=z(r),$+=z(l),d+=z(o),p+=z(s),i&&m.push({fileName:n,bundleSize:r,minSize:l,gzipSize:o,brotliSize:s})}}).generateBundle(...e)},closeBundle(){if(i){console.log("");for(const e of m)console.log(`  ${u}${e.fileName}${o} â†’ ${e.bundleSize} (min: ${e.minSize}, gz: ${e.gzipSize}, br: ${e.brotliSize})`)}const t=`${a}Bundle:${o}${c}${r(S)}${o} | ${a}Minified:${o}${c}${r($)}${o} | ${a}Gzipped:${c}${r(d)}${o} | ${a}Brotli:${o}${c}${r(p)}`;console.log(o),console.log(e(`${s}${t}${o}`,n))}}};
